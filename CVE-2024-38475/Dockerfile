# CVE-2024-38475 POC
FROM httpd:2.4.58

RUN apt-get update

# Enable CGI-scripts
RUN sed -i 's/^\s*#LoadModule cgid_module/LoadModule cgid_module/g' /usr/local/apache2/conf/httpd.conf

# Enable the test-cgi script
RUN sed -i '1s/^#/#!\/bin\/bash/' /usr/local/apache2/cgi-bin/test-cgi
RUN chmod 755 /usr/local/apache2/cgi-bin/test-cgi

# Add a bad rewrite rule
RUN sed -i 's/^#LoadModule rewrite_module/LoadModule rewrite_module/g' /usr/local/apache2/conf/httpd.conf
RUN echo "RewriteEngine on" >> /usr/local/apache2/conf/httpd.conf
RUN echo 'RewriteRule "^/html/(.*)$" "/$1.html"' >> /usr/local/apache2/conf/httpd.conf
