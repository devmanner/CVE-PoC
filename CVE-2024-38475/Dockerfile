# CVE-2024-38475 POC
FROM httpd:2.4.58

RUN apt-get update

# Enable CGI-scripts
RUN sed -i 's/^\s*#LoadModule cgid_module/LoadModule cgid_module/g' /usr/local/apache2/conf/httpd.conf

# Add a bad rewrite rule
RUN sed -i 's/^#LoadModule rewrite_module/LoadModule rewrite_module/g' /usr/local/apache2/conf/httpd.conf
RUN echo "RewriteEngine on" >> /usr/local/apache2/conf/httpd.conf
RUN echo 'RewriteRule "^/html/(.*)$" "/$1.html"' >> /usr/local/apache2/conf/httpd.conf
COPY my_cgi_script.pl /usr/local/apache2/cgi-bin
RUN chmod 755 /usr/local/apache2/cgi-bin/my_cgi_script.pl
